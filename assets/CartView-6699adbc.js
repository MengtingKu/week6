import{_ as k,a as h,r as f,o as i,c,e,F as v,h as V,t as u,i as w,b as d,w as C,d as x,j as y,v as N,k as b,l as P}from"./index-be1a73cb.js";const{VITE_APP_URL:m,VITE_APP_PATH:_}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"qwe1234",BASE_URL:"/week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},T={data(){return{isLoading:!0,products:[],productId:"",page:{},cart:{},carts:[],hasItem:!0,loadingItem:"",user:{email:"",name:"",address:"",tel:""},message:""}},methods:{thousands(s){var n;let t=new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g");return(n=s==null?void 0:s.toString())==null?void 0:n.replace(t,",")},getCartList(){h.get(`${m}/api/${_}/cart`).then(s=>{this.isLoading=!0,this.cart=s.data.data,this.carts=this.cart.carts,this.isLoading=!1,this.cart.carts.length?this.hasItem=!1:this.hasItem=!0}).catch(s=>{console.log(s)})},cartQty(s){const t={product_id:s.product_id,qty:s.qty};this.loadingItem=s.id,h.put(`${m}/api/${_}/cart/${s.id}`,{data:t}).then(n=>{alert(`${s.product.title}${n.data.message}`),this.loadingItem="",this.getCartList()}).catch(n=>{console.log(n)})},delItem(s){this.loadingItem=s.id,h.delete(`${m}/api/${_}/cart/${s.id}`).then(t=>{alert(`${s.product.title}${t.data.message}`),this.loadingItem="",this.getCartList()}).catch(t=>{console.log(t)})},delAllItem(){h.delete(`${m}/api/${_}/carts`).then(s=>{console.log(s.data),alert("已經把所有商品移除囉！ ʕ·͡ˑ·ཻʔ "),this.getCartList()}).catch(s=>{console.log(s),alert(s.data.message)})},onSubmit(s){console.log(s),this.isLoading=!0;const t={user:{name:this.user.name,email:this.user.email,tel:this.user.tel,address:this.user.address},message:this.message};if(this.carts.length===0)return alert("購物車內無資料，請選擇一樣商品吧~");h.post(`${m}/api/${_}/order`,{data:t}).then(n=>{this.carts=[],this.getCartList(),alert(n.data.message),this.$refs.form.resetForm(),this.isLoading=!1}).catch(n=>{console.log(n),alert(n.data.message)})},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"}},mounted(){this.getCartList()}},E=e("h1",null,"這是一個「購物車」頁面",-1),S={key:0,class:"loading"},U=e("div",{class:"bounceBall me-2"},null,-1),q=e("div",{class:"text h5"},"NOW LOADING...ʕ̯•͡ˑ͓•̯᷅ʔ",-1),A=[U,q],B={key:1},D={class:"table align-middle"},O=e("thead",null,[e("tr",null,[e("th",{width:"10%"},"選項"),e("th",null,"品名"),e("th",{width:"15%"},"單價"),e("th",{width:"20%",class:"text-end"},"數量/單位"),e("th",{width:"20%",class:"text-end"},"金額")])],-1),R=["onClick","disabled"],F=e("div",{class:"text-success"},"已套用優惠券",-1),H={class:"input-group input-group-sm"},M=["onUpdate:modelValue","onChange","disabled"],$=["value"],j={class:"ms-3"},G={class:"text-end"},Q=e("small",{class:"text-success"},"折扣價：",-1),W={key:1},z=e("td",{colspan:"5",class:"text-center text-warning text-bolder h5"}," 尚未選擇商品 ",-1),K=[z],J=e("td",{colspan:"4",class:"text-end"},"總計",-1),X={class:"text-end fw-bold"},Y=e("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),Z={class:"text-end text-success fw-bold"},ee={class:"my-5 row justify-content-center"},se={key:0,class:"loading"},te=e("div",{class:"bounceBall me-2"},null,-1),le=e("div",{class:"text h5"},"NOW CHECKING...ʕ̯•͡ˑ͓•̯᷅ʔ",-1),ae=[te,le],oe={class:"mb-3"},ne=e("label",{for:"email",class:"form-label"},"Email",-1),de={class:"mb-3"},ie=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ce={class:"mb-3"},re=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ue={class:"mb-3"},he=e("label",{for:"address",class:"form-label"},"收件人地址",-1),me={class:"mb-3"},_e=e("label",{for:"message",class:"form-label"},"留言",-1),ge=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},[x(" 送出訂單 "),e("i",{class:"fa-solid fa-file-import"})])],-1);function pe(s,t,n,fe,l,r){const I=f("font-awesome-icon"),g=f("the-field"),p=f("error-message"),L=f("the-form");return i(),c(v,null,[E,l.isLoading?(i(),c("div",S,A)):(i(),c("div",B,[e("table",D,[O,e("tbody",null,[l.carts.length?(i(!0),c(v,{key:0},V(l.cart.carts,o=>(i(),c("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm","aria-label":"btn",onClick:a=>r.delItem(o),disabled:o.id===l.loadingItem},[d(I,{icon:"fa-solid fa-trash"})],8,R)]),e("td",null,[x(u(o.product.title)+" ",1),F]),e("td",null,"NT$ "+u(o.product.price),1),e("td",null,[e("div",H,[y(e("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":a=>o.qty=a,"aria-label":"qty",onChange:a=>r.cartQty(o),disabled:o.id===l.loadingItem},[(i(),c(v,null,V(20,a=>e("option",{value:a,key:a},u(a),9,$)),64))],40,M),[[N,o.qty]]),e("span",j,u(o.product.unit),1)])]),e("td",G,[Q,x(" NT$ "+u(r.thousands(o.total)),1)])]))),128)):(i(),c("tr",W,K))]),e("tfoot",null,[e("tr",null,[J,e("td",X,"NT$ "+u(r.thousands(l.cart.total)),1)]),e("tr",null,[Y,e("td",Z," NT$ "+u(r.thousands(l.cart.final_total)),1)])])]),e("div",ee,[l.isLoading?(i(),c("div",se,ae)):w("",!0),d(L,{ref:"form",class:"col-md-6",onSubmit:r.onSubmit},{default:C(({errors:o})=>[e("div",oe,[ne,d(g,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.user.email,"onUpdate:modelValue":t[0]||(t[0]=a=>l.user.email=a)},null,8,["class","modelValue"]),d(p,{name:"email",class:"invalid-feedback"})]),e("div",de,[ie,d(g,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.user.name,"onUpdate:modelValue":t[1]||(t[1]=a=>l.user.name=a)},null,8,["class","modelValue"]),d(p,{name:"姓名",class:"invalid-feedback"})]),e("div",ce,[re,d(g,{id:"tel",name:"電話",type:"text",class:b(["form-control",{"is-invalid":o.電話}]),modelValue:l.user.tel,"onUpdate:modelValue":t[2]||(t[2]=a=>l.user.tel=a),rules:r.isPhone,placeholder:"請輸入電話"},null,8,["modelValue","rules","class"]),d(p,{name:"電話",class:"invalid-feedback"})]),e("div",ue,[he,d(g,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.user.address,"onUpdate:modelValue":t[3]||(t[3]=a=>l.user.address=a)},null,8,["class","modelValue"]),d(p,{name:"地址",class:"invalid-feedback"})]),e("div",me,[_e,y(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[4]||(t[4]=a=>l.message=a)},null,512),[[P,l.message]])]),ge]),_:1},8,["onSubmit"])])]))],64)}const ve=k(T,[["render",pe]]);export{ve as default};
